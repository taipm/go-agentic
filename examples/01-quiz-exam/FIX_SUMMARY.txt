â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     QUIZ EXAM - 5W2H FIX ANALYSIS SUMMARY                   â•‘
â•‘                                                                              â•‘
â•‘                     ğŸ“Š Full Analysis: 5W2H_ANALYSIS.md                      â•‘
â•‘                     ğŸš€ Quick Start: QUICK_FIX_GUIDE.md                      â•‘
â•‘                     ğŸ¯ Decision: CORE_vs_EXAMPLE_DECISION.md                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. THE PROBLEM (5W2H Framework)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

WHAT?  âœ Questions and student answers stored as empty strings/nil
WHERE? âœ Question text never reaches RecordAnswer tool
WHY?   âœ LLM generates questions but doesn't include them in tool call
WHEN?  âœ Starting from Question 1, persists through all 10 questions
WHO?   âœ Both LLM (confusion) and Tool (no validation)
HOW?   âœ (1) Unclear agent prompt, (2) No validation, (3) Auto-save redundancy
COST?  âœ 60 minutes to fix critical issues

Result: Exam completes with 10/10 but report shows no questions/answers


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2. ROOT CAUSE ANALYSIS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Data Flow Breakdown:

    [Teacher Agent]
         â†“
         âœ… Generates: "Sá»‘ nÃ o lÃ  2+2?"
         â†“
    [Stream Event]
         â†“
         âœ… Content shows question text
         â†“
    [Main.go]  âŒ DISCONNECT HERE
         â†“
         Logs question to stderr, but doesn't forward to tool
         â†“
    [RecordAnswer Tool]
         â†“
         âŒ Receives: { question: "", student_answer: "", is_correct: true }
         â†“
    [Report]
         â†“
         âŒ Writes: "**CÃ¢u há»i:** " (empty)


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
3. CRITICAL FIXES (3 Issues - 60 Minutes)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIX #1: AGENT PROMPT - config/agents/teacher.yaml (20 min)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚ Problem:  LLM doesn't understand to include question in tool call           â”‚
â”‚ Solution: Rewrite system_prompt with explicit 4-step workflow               â”‚
â”‚ Impact:   âœ… LLM now explicitly extracts question text into tool parameter  â”‚
â”‚ Location: Lines 28-74 (entire system_prompt section)                       â”‚
â”‚                                                                              â”‚
â”‚ NEW PROMPT:                                                                 â”‚
â”‚   STEP 1: Check remaining questions with QuizExam(action="get_status")     â”‚
â”‚   STEP 2: Ask question and emit [QUESTION]                                 â”‚
â”‚   STEP 3: Call QuizExam(action="record_answer",                            â”‚
â”‚            question="[EXACT TEXT]",                                         â”‚
â”‚            student_answer="[STUDENT RESPONSE]",                            â”‚
â”‚            is_correct=true/false)                                           â”‚
â”‚   STEP 4: If questions_remaining > 0, loop to STEP 1                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIX #2: ADD VALIDATION - internal/tools.go (30 min)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚ Problem:  RecordAnswer accepts empty question="" without error              â”‚
â”‚ Solution: Add validation checks that REJECT invalid data                    â”‚
â”‚ Impact:   âŒ LLM gets error, forced to include proper data                 â”‚
â”‚ Location: RecordAnswer Func, lines 347-410                                 â”‚
â”‚                                                                              â”‚
â”‚ ADD THESE CHECKS:                                                           â”‚
â”‚   âœ… question must not be empty or nil                                     â”‚
â”‚   âœ… student_answer must not be empty or nil                               â”‚
â”‚   âœ… is_correct must be explicitly true/false (no defaults)                â”‚
â”‚                                                                              â”‚
â”‚ When LLM violates: Return error JSON for LLM to see and fix                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIX #3: REMOVE AUTO-SAVE - internal/tools.go (10 min)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚ Problem:  Report written after EACH question = 10 incomplete files          â”‚
â”‚ Solution: DELETE auto-save from RecordAnswer, only write at end             â”‚
â”‚ Impact:   âœ… Single clean report with complete data                        â”‚
â”‚ Location: Lines 424-428 (delete entire if block)                           â”‚
â”‚                                                                              â”‚
â”‚ DELETE:                                                                     â”‚
â”‚   if err := state.WriteReportToFile(""); err != nil { ... }               â”‚
â”‚                                                                              â”‚
â”‚ Why:  Report written after EACH question has incomplete data               â”‚
â”‚       Better to write ONCE at end with ALL answers recorded                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TOTAL TIME: 60 minutes
ALL CRITICAL ISSUES RESOLVED âœ…


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
4. OPTIONAL IMPROVEMENTS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

FIX #4: CODE SIMPLIFICATION (90 min)
  â€¢ Consolidate 5 tools â†’ 2 tools
  â€¢ Reduce from 200 lines â†’ 100 lines
  â€¢ Single entry point per function
  â€¢ See: 5W2H_ANALYSIS.md Phase 2

FIX #5: CORE ENHANCEMENT (170 min) - OPTIONAL
  â€¢ Add validation framework to core/tools/
  â€¢ Makes validation reusable across all examples
  â€¢ Backward compatible (opt-in)
  â€¢ See: 5W2H_ANALYSIS.md Phase 3 & CORE_vs_EXAMPLE_DECISION.md


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
5. CORE vs EXAMPLE DECISION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Question: Should we modify CORE or EXAMPLE?

Answer: EXAMPLE ONLY (80%), CORE optional (20%)

Why?
  â€¢ LLM prompt issue â†’ EXAMPLE specific (teacher.yaml)
  â€¢ Tool validation â†’ EXAMPLE specific (quiz-exam tools)
  â€¢ Auto-save pattern â†’ EXAMPLE specific (quiz workflow)
  â€¢ Code complexity â†’ EXAMPLE specific (design choice)
  â€¢ Validation framework â†’ CORE optional (would benefit all)

Recommendation:
  Phase 1: Fix EXAMPLE only (60 min) â† START HERE
  Phase 2: Optional tool consolidation (90 min)
  Phase 3: Optional CORE enhancement (170 min) â† ONLY IF NEEDED

No breaking changes to CORE âœ…
All fixes stay in /examples/01-quiz-exam/ âœ…


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
6. FILES TO MODIFY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CRITICAL (MUST CHANGE):
  âœï¸  config/agents/teacher.yaml
      - Rewrite system_prompt (lines 28-74)

  âœï¸  internal/tools.go
      - Add validation (lines 347-410)
      - Remove auto-save (delete lines 424-428)

OPTIONAL (NICE-TO-HAVE):
  âœï¸  internal/tools.go
      - Consolidate tools (refactor entire CreateQuizTools)

  ğŸ“ core/tools/validator.go
      - New file for validation framework
      - Only if implementing CORE enhancement


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
7. VERIFICATION CHECKLIST
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

After applying Fix #1-3, verify:

  â˜ Teacher.yaml has new system_prompt workflow
  â˜ RecordAnswer has question validation
  â˜ RecordAnswer has student_answer validation
  â˜ RecordAnswer has is_correct validation
  â˜ Auto-save WriteReportToFile removed from RecordAnswer
  â˜ Tests pass: go run ./cmd/main.go

Verify output shows:
  â˜ [TOOL] RecordAnswer output shows: "CÃ¢u há»i: ..." (NOT empty)
  â˜ [TOOL] RecordAnswer output shows: "Tráº£ lá»i: ..." (NOT <nil>)
  â˜ Report file shows actual questions and answers (NOT empty)
  â˜ Exam completes with 10/10 (or actual score if some wrong)


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
8. DOCUMENTATION FILES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

5W2H_ANALYSIS.md (THIS DIRECTORY)
  â”œâ”€ WHAT? - Data bá»‹ sai nhÆ° nÃ o
  â”œâ”€ WHERE? - á» Ä‘Ã¢u bá» lá»¡ dá»¯ liá»‡u
  â”œâ”€ WHY? - Táº¡i sao láº¡i sai (5 levels deep)
  â”œâ”€ WHEN? - Timeline of failure
  â”œâ”€ WHO? - Component responsibility
  â”œâ”€ HOW? - Fix strategy (Chi tiáº¿t tá»«ng fix)
  â””â”€ HOW MUCH? - Pháº¡m vi + effort estimate

QUICK_FIX_GUIDE.md (THIS DIRECTORY)
  â”œâ”€ 1-minute problem summary
  â”œâ”€ 3 critical fixes with code snippets
  â”œâ”€ Testing checklist
  â”œâ”€ Effort estimate: 60 minutes
  â””â”€ Next steps

CORE_vs_EXAMPLE_DECISION.md (THIS DIRECTORY)
  â”œâ”€ Decision matrix: CORE or EXAMPLE?
  â”œâ”€ Why each fix belongs where
  â”œâ”€ 2 strategy comparisons
  â”œâ”€ Optional CORE enhancements
  â””â”€ Final recommendation: EXAMPLE only

FIX_SUMMARY.txt (THIS FILE)
  â””â”€ One-page reference of everything


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
9. QUICK START
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Read: QUICK_FIX_GUIDE.md (5 minutes)
2. Read: CORE_vs_EXAMPLE_DECISION.md (5 minutes)
3. Apply: Fix #1 to config/agents/teacher.yaml (20 minutes)
4. Apply: Fix #2 to internal/tools.go (30 minutes)
5. Apply: Fix #3 to internal/tools.go (10 minutes)
6. Test:  go run ./cmd/main.go (5 minutes)
7. Verify: Check output and report file (5 minutes)

TOTAL: ~60 minutes to working state âœ…


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TÆ° duy 5W2H: PhÃ¢n tÃ­ch há»‡ thá»‘ng, xÃ¡c Ä‘á»‹nh Ä‘Ãºng vá»‹ trÃ­ cáº§n sá»­a, giáº£m thiá»ƒu rá»§i ro
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
